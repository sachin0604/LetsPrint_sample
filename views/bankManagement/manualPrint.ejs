<!DOCTYPE html>

<html>

<head>
    <% include bankCommanComp/header.ejs %>
</head>

<body>

    <!--navbar start-->
    <% include bankCommanComp/navbar.ejs %>
    <!--navbar end-->

    <main class="paddingBody">
        <div class="container">

            <!-- onSubmit="return addManualChequeEntry()" -->
            <!-- <form method="POST" id="saveChequeEntryForm"> -->
                <div class="row z-depth-3">
                    <div class="row">
                        <div class="col s12 m10 l10 offset-l1 ">

                            <div class="col l12 m12 s12">
                                <h4 class="center"> Print Manual Cheques </h4>
                            </div>

                            <div class="row" style="margin-bottom:5px;">
                                <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                                    <i class="material-icons prefix">settings_overscan </i>
                                    <span class="selectLabel"><span class="red-text">*&nbsp;
                                            <select id="templateId" name="templateId" required="" aria-required="true">
                                                <option value="0" selected>Choose Template</option>
                                            </select>
                                </div>

                                <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                                    <i class="material-icons prefix">rate_review </i>
                                    <input type="text" id="chequeNo" name="chequeNo" class="onlyNumberAllowed" value=""
                                        maxlength="6" minlength="6">
                                    <label for="chequeNo"><span class="red-text">*&nbsp;</span> Enter Cheque Number</label>
                                </div>

                            </div>
                            <div class="row" style="margin-bottom:5px;">

                                <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                                    <i class="material-icons prefix">person </i>
                                    <input type="text" id="payeeName" name="payeeName" value="">
                                    <label for="payeeName"><span class="red-text">*&nbsp;</span> Enter Payee Name</label>
                                </div>

                                <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                                    <i class="fa fa-inr prefix"></i>
                                    <input type="text" id="amountId" class="onlyNumberAllowed" name="amountId" value="">
                                    <label for="amountId"><span class="red-text">*&nbsp;</span>Enter Amount</label>
                                </div>

                            </div>
                            <div class="row" style="margin-bottom:5px;">

                                <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                                    <i class="material-icons prefix">date_range</i>
                                    <input type="date" class="datepicker chequeDate" id="chequeDate" name="chequeDate"
                                        value="">
                                    <label for="chequeDate"><span class="red-text">*&nbsp;</span> Select cheque date</label>
                                </div>

                                <div class=" col s12 m12 l5 push-l1 push-m1" style="margin-left:1%;margin-top:2%;">
                                    <input type="checkbox" id="acPayee" name="acPayee" value="" checked>
                                    <label for="acPayee"><span class="red-text">*&nbsp;</span>Account Payee</label>
                                </div>

                            </div>
                            <div class="row" style="margin-bottom:5px;">
                                <div class="input-field col s12 m5 l10 push-l1 push-m1 ">
                                    <i class="material-icons prefix">rate_review </i>
                                    <input type="text" id="remark" name="remark" value="">
                                    <label for="remark"><span class="red-text">*&nbsp;</span>Enter remark</label>
                                </div>

                            </div>

                            <!-- Print and preview Button div -->
                            <div class="row">
                                <div class="input-field col s12 m3 l6 offset-l3 center-align">
                                    <button class="btn waves-effect waves-light blue-gradient" type="button" id="printBtn">Print<i
                                            class="material-icons right">send</i>
                                    </button>
                                </div>
                                <!-- <div class="input-field col s12 m3 l3 center-align">
                                <button class="btn waves-effect waves-light blue-gradient" type="button" id="previewBtn">Preview<i
                                     class="material-icons right">send</i> </button>
                            </div> -->

                            </div>


                            <!-- Cheque Preview div start here -->
                            <div class="row" id="chequePreview">
                                <div class="container1" id="container1" style="position: relative">

                                    <div class="center-align" style="height: 100%;padding:0;">



                                        <div class="center-align" style="padding:0">

                                            <img style="border: 1px solid; height: 360px; width: 816px;" id="addImage" />





                                            <!-- style="position: absolute;
                                        /* right: 110px; */
                                       top: 20.5px;
                                       min-height: 15px;
                                       max-height: 50px;
                                       min-width: 90px;
                                       /* border: 1px solid blue; */
                                       left: 514px;" -->
                                            <div id="chqDatePreView" class="chqDate" style="position: absolute; top: 5%; left:620px; width: 180px; height: 30px; min-height: 15px; max-height: 50px; min-width: 90px; border: 0px solid blue; padding: 5px; background: solid white;">


                                                <div id="lineDate">
                                                    <p id="lineDatePreview" class="textPosition" style="text-align:center">DD/MM/YYYY</p>
                                                </div>

                                                <!-- Box Formate Date Start here -->
                                                <div id="boxDate">
                                                    <div id="d1" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="d1Preview" class="textPosition1" style="text-align:center">D</p>
                                                    </div>

                                                    <div id="d2" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="d2Preview" class="textPosition1" style="text-align:center">D</p>
                                                    </div>

                                                    <div id="m1" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="m1Preview" class="textPosition1" style="text-align:center">M</p>
                                                    </div>

                                                    <div id="m2" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="m2Preview" class="textPosition1" style="text-align:center">M</p>
                                                    </div>

                                                    <div id="y1" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="y1Preview" class="textPosition1" style="text-align:center">Y</p>
                                                    </div>

                                                    <div id="y2" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="y2Preview" class="textPosition1" style="text-align:center">Y</p>
                                                    </div>

                                                    <div id="y3" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="y3Preview" class="textPosition1" style="text-align:center">Y</p>
                                                    </div>

                                                    <div id="y4" class="dateBox dateDimension" style="display:table-cell;vertical-align: middle;">
                                                        <p id="y4Preview" class="textPosition1" style="text-align:center">Y</p>
                                                    </div>

                                                </div>

                                                <!-- Box Format Date End here -->
                                            </div>




                                            <div id="payeeNamePreView" class="draggable" style="position: absolute; left: 120px; top: 60px; width: 400px; height: 30px; border: 0px solid blue; padding: 5px; min-width: 290px;">
                                                <p id="payeeNamePreViewText" class="textPosition" style="margin:0">Payee
                                                    Name=====================></p>
                                            </div>

                                            <div id="amountPreView" class="draggable" style="position: absolute; right: 60px; top: 130px; width: 130px; height: 30px; min-width: 60px; border: 0px solid blue; padding: 5px;">
                                                <p id="amountPreViewText" class="textPosition" style="margin:0">***
                                                    Amount</p>
                                            </div>

                                            <div id="amountInWordPreView" class="draggable" style="position: absolute; left: 120px; top: 100px; width: 380px; height: 30px; border: 0px solid blue; padding: 5px; min-width: 290px;">
                                                <p id="amountInWordPreViewText" class="textPosition" style="margin:0">Amount
                                                    in word================></p>
                                            </div>

                                            <div id="acPayeePreView" class="draggable" style="position: absolute; left: 350px; top: 170px; width: 120px; height: 30px; border: 0px solid white; padding: 5px; min-width: 75px;">
                                                <p id="acPayeePreViewText" class="textPosition" style="margin:0">A/c
                                                    Payee</p>
                                            </div>
                                        </div>

                                    </div>


                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            <!-- </form> -->

        </div>
    </main>

</body>
<script>
    var chqNoValid = false;
    var chqDateFormate = ""; /* line or box formate */

    $(document).ready(function () {

        $("#printBtn").click(function () {
            if (feildValidation()) {
                window.print();
                SaveManualChequeEntry();
                //$('#saveManualChequeForm').submit();
            }
        });


        fetchChequeTemplateForDropDown();
        $('.onlyNumberAllowed').keypress(function (event) {
            var key = event.which;
            if (!(key >= 48 && key <= 57))
                event.preventDefault();
        });
        $('#payeeName').on('keyup blur', function () {
            $('#payeeNamePreViewText').text($(this).val());
        });

        $('#amountId').on('keyup blur', function () {
            $('#amountPreViewText').text("***" + $(this).val() + "/-");
            $('#amountInWordPreViewText').text(convertNumberToWords($(this).val()) + "Rupees Only");
        })



        $('#chequeDate').on('change', function () {
            /* var dateData=new Date($('#chequeDate').val());
            var date=dateData.getDate()+"";
            var month=dateData.getMonth();
            var year=dateData.getFullYear();
        	
            var newDate1=date.substring(0,1);
            var newDate2=date.substring(1,2);
            var m1=month.substring(0,1);
            var m2=month.substring(1,2);
            var y1=year.substring(0,1);
            var y2=year.substring(1,2);
            var y3=year.substring(2,3);
            var y4=year.substring(3,4); */
            var dateData = moment($(this).val());
            var date = dateData.format("DD");
            var month = dateData.format("MM");
            var year = dateData.format("YYYY");


            var lineDate = date + "/" + month + "/" + year;
            /* $('#lineDatePreview').text("21/01/2010"); */
            if (chqDateFormate == "lineFormate") {

                $('#lineDatePreview').text(lineDate);

            } else {

                var d1 = date.substring(0, 1);
                $('#d1Preview').text(d1);

                var d2 = date.substring(1, 2);
                $('#d2Preview').text(d2);

                var m1 = month.substring(0, 1);
                $('#m1Preview').text(m1);

                var m2 = month.substring(1, 2);
                $('#m2Preview').text(m2);

                var y1 = year.substring(0, 1);
                $('#y1Preview').text(y1);

                var y2 = year.substring(1, 2);
                $('#y2Preview').text(y2);

                var y3 = year.substring(2, 3);
                $('#y3Preview').text(y3);

                var y4 = year.substring(3, 4);
                $('#y4Preview').text(y4);

            }


        });

        //check that enter cheque number is printed or not
        $('#chequeNo').on('blur', function () {
            var chequeNo = $("#chequeNo").val();
            if (chequeNo == "") {
                Materialize.Toast.removeAll();
                Materialize.toast('Please enter cheque number', '2000', 'red lighten-2');
            } else {
                var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.CHEQUE_NO_PRINTED_OR_NOT%>/" + chequeNo;
                $.ajax({
                    type: "get",
                    url: url,
                    success: function (data) {
                        var isThisChequePrinted = data;
                        if (isThisChequePrinted == "printed") {
                            var $toastContent = $('<span>This Cheque No. is already Printed<span>');
                            Materialize.Toast.removeAll();
                            Materialize.toast($toastContent, 3000);
                            chqNoValid = false;
                            //return false
                        }
                        else {
                            chqNoValid = true;
                        }
                    },
                    error: function (xhr, status, error) {
                        $('.preloader-wrapper').hide();
                        $('.preloader-background').hide();
                        Materialize.Toast.removeAll();
                        Materialize.toast('Something Went Wrong!', '2000', 'red lighten-2');
                    }

                });

            }

        });

        $('#acPayee').on('change', function () {
            if ($(this).is(':checked')) {
                $('#acPayeePreViewText').text("A/c Payee")
            } else {
                $('#acPayeePreViewText').text("")
            }
        });

        // on templated select fetch their data
        /* on Template  change fetch their details Id*/
        $('#templateId').change(function () {

            var id = $('#templateId').val();
            if (id === "0") {
                //changeTb="area";
                //table.draw();
                return false;
            }

            var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.FETCH_CB_TEMPLATE_BY_ID%>/" + id;
            $.ajax({
                type: "Get",

                url: url,
                dataType: "json",
                success: function (data) {
                    var data = data.chqTemplate;
                    var imgSrc = data.templateImgBase64;
                    console.log(data);
                    $("#addImage").attr("src", imgSrc);
                    $("#payeeNamePreView").css({
                        "left": data.payeeNameLeft + "px",
                        "width": data.payeeNameWidth + "px",
                        "top": data.payeeNameTop + "px"

                    });


                    $("#amountPreView").css({
                        "left": data.amountLeft + "px",
                        "width": data.amountWidth + "px",
                        "top": data.amountTop + "px"

                    });
                    $("#amountInWordPreView").css({
                        "left": data.amountInWordLeft + "px",
                        "width": data.amountInWordWidth + "px",
                        "top": data.amountInWordTop + "px"

                    });

                    $("#acPayeePreView").css({
                        "left": data.accPayeeLeft + "px",
                        "width": data.accPayeeWidth + "px",
                        "top": data.accPayeeTop + "px"

                    });
                    var dateLeft = 12 + parseFloat(data.chqDateLeft);
                    $("#chqDatePreView").css({
                        //"left": 12+parseFloat(data.chqDateLeft) + "px",
                        "left": parseFloat(dateLeft) + "px",
                        "top": data.chqDateTop + "px",
                        "width": data.chqDateWidth + "px"


                    });

                    // $("#chequeDate").val("");//sachin

                    chqDateFormate = data.dateFormate;
                    if (chqDateFormate == "boxFormate") {
                        $('#boxDate').show();
                        $('#lineDate').hide();
                        var boxDivWidth = parseFloat(data.chqDateWidth) / 8.25;
                        $('.dateDimension').css({
                            "height": data.chqDateHeight + "px",
                            "width": boxDivWidth + "px"
                        });
                    } else {
                        $('#boxDate').hide();
                        $('#lineDate').show();
                    }

                    //console.log(CategoryIgst);
                    $('.preloader-wrapper').hide();
                    $('.preloader-background').hide();

                },
                error: function (xhr, status, error) {
                    $('.preloader-wrapper').hide();
                    $('.preloader-background').hide();
                    Materialize.Toast.removeAll();
                    Materialize.toast('Something Went Wrong!', '2000', 'red lighten-2');
                }
            });

        });
    });

    //fetch template data for dropdown
    function fetchChequeTemplateForDropDown() {


        var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.FETCH_CB_TEMPLATE_LIST%>";
        $.ajax({
            url: url,
            type: "GET",
            // data: data,
            // contentType: 'application/json,charset=utf-8',
            beforeSend: function () {
                $(".hiddenAjaxLoader").show();
            },
            complete: function () {
                $(".hiddenAjaxLoader").hide();
            },
            dataType: 'json',
            success: function (data) {
                if (data.success == true) {
                    Materialize.Toast.removeAll();
                    setTemplateDataForDropDown(data);

                } else if (data.success == false) {
                    Materialize.Toast.removeAll();
                    Materialize.toast(data.msg, 3000, 'toastError');
                }

                // w.postMessage({
                //     cmd: TaskListMessage.LOAD_BRAND,
                //     data: data
                // });
            },
            error: function (xhr) {
                Materialize.Toast.removeAll();
                Materialize.toast('Something went wrong. Please retry', 3000, 'toastError');
                $(".hiddenAjaxLoader").hide();
                $("body").css({
                    "overflow": "show"
                });
            }
        });




    }

    //set data in template dropdown
    function setTemplateDataForDropDown(templateData) {
        var data = templateData.chqTemplate;

        $("select#templateId").empty();

        $('<option>', {
            value: 0,
            text: "Select Template Design"
        }).appendTo("select#templateId");

        for (i = 0; i < data.length; i++) {
            // for (i = data.length - 1; i >= 0; i--) {

            $('<option>', {
                value: data[i].id,
                text: data[i].templateName
            }).appendTo("select#templateId");
        }

        $("select#templateId").trigger("change");
    }

    //convert number to word
    function convertNumberToWords(amount) {
        var words = new Array();
        words[0] = '';
        words[1] = 'One';
        words[2] = 'Two';
        words[3] = 'Three';
        words[4] = 'Four';
        words[5] = 'Five';
        words[6] = 'Six';
        words[7] = 'Seven';
        words[8] = 'Eight';
        words[9] = 'Nine';
        words[10] = 'Ten';
        words[11] = 'Eleven';
        words[12] = 'Twelve';
        words[13] = 'Thirteen';
        words[14] = 'Fourteen';
        words[15] = 'Fifteen';
        words[16] = 'Sixteen';
        words[17] = 'Seventeen';
        words[18] = 'Eighteen';
        words[19] = 'Nineteen';
        words[20] = 'Twenty';
        words[30] = 'Thirty';
        words[40] = 'Forty';
        words[50] = 'Fifty';
        words[60] = 'Sixty';
        words[70] = 'Seventy';
        words[80] = 'Eighty';
        words[90] = 'Ninety';
        amount = amount.toString();
        var atemp = amount.split(".");
        var number = atemp[0].split(",").join("");
        var n_length = number.length;
        var words_string = "";
        if (n_length <= 9) {
            var n_array = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0);
            var received_n_array = new Array();
            for (var i = 0; i < n_length; i++) {
                received_n_array[i] = number.substr(i, 1);
            }
            for (var i = 9 - n_length, j = 0; i < 9; i++ , j++) {
                n_array[i] = received_n_array[j];
            }
            for (var i = 0, j = 1; i < 9; i++ , j++) {
                if (i == 0 || i == 2 || i == 4 || i == 7) {
                    if (n_array[i] == 1) {
                        n_array[j] = 10 + parseInt(n_array[j]);
                        n_array[i] = 0;
                    }
                }
            }
            value = "";
            for (var i = 0; i < 9; i++) {
                if (i == 0 || i == 2 || i == 4 || i == 7) {
                    value = n_array[i] * 10;
                } else {
                    value = n_array[i];
                }
                if (value != 0) {
                    words_string += words[value] + " ";
                }
                if ((i == 1 && value != 0) || (i == 0 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Crores ";
                }
                if ((i == 3 && value != 0) || (i == 2 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Lakhs ";
                }
                if ((i == 5 && value != 0) || (i == 4 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Thousand ";
                }
                if (i == 6 && value != 0 && (n_array[i + 1] != 0 && n_array[i + 2] != 0)) {
                    words_string += "Hundred and ";
                } else if (i == 6 && value != 0) {
                    words_string += "Hundred ";
                }
            }
            words_string = words_string.split("  ").join(" ");
        }
        return words_string;
    }


    // Validation Function
    function feildValidation() {
        var payeeName = $('#payeeName').val();
        var amt = $('#amountId').val();
        //var amtInWord = convertNumberToWords(amt);
        var chqDate = $('#chequeDate').val();
        var chqNo = $('#chequeNo').val();
        var remark = $('#remark').val();

        if (chqNo != "") {
            if (chqNo.length != 6) {
                var $toastContent = $('<span>Please Enter Valid Cheque No<span>');
                Materialize.Toast.removeAll();
                Materialize.toast($toastContent, 3000);
                return false;
            } else if (chqNoValid == false) {
                var $toastContent = $('<span>Cheque No. is already exist.<span>');
                Materialize.Toast.removeAll();
                Materialize.toast($toastContent, 3000);
                return false;
            }
        }
        if (chqNo == "") {

            var $toastContent = $('<span>Please Enter  Cheque No.<span>');
            Materialize.Toast.removeAll();
            Materialize.toast($toastContent, 3000);
            return false
        } else if (payeeName == "") {
            msg = "Please Enter Payee Name";
            //message.innerHTML = "Please Enter Payee Name";
            $('#msg').text(msg);
            //window.alert("Please Enter Payee Name for Cheque No:"+chqNo)

            var $toastContent = $('<span>Please Enter Payee Name for Cheque No.<span>').add('<span class="yellow-text">' + chqNo + '</span>');
            Materialize.Toast.removeAll();
            Materialize.toast($toastContent, 3000);
            return false
        } else if (amt <= 0) {
            msg = "Please Enter Cheque Amount";
            //message.innerHTML = "Please Enter Cheque Amount";
            $('#msg').text(msg);
            //window.alert("Please Enter Cheque Amount for Cheque No:"+chqNo)
            var $toastContent = $(
                '<span>Please Enter Cheque Amount for Cheque No.<span>')
                .add('<span class="yellow-text">' + chqNo + '</span>');
            Materialize.Toast.removeAll();
            Materialize.toast($toastContent, 3000);
            return false;
        } else if (chqDate == "") {
            msg = "Please Enter Cheque Date for Cheque No:" + chqNo;
            //message.innerHTML = "Please Enter Cheque Date";
            $('#msg').text(msg);
            //window.alert(msg)
            var $toastContent = $(
                '<span>Please Enter Cheque Date for Cheque No.<span>').add(
                    '<span class="yellow-text">' + chqNo + '</span>');
            Materialize.Toast.removeAll();
            Materialize.toast($toastContent, 3000);
            return false;
        } else if (remark == "") {
            msg = "Please Enter Remark for Cheque No:" + chqNo;
            //message.innerHTML = "Please Enter Cheque Date";
            $('#msg').text(msg);
            //window.alert(msg)
            var $toastContent = $(
                '<span>Please Enter Remark for Cheque No.<span>').add(
                    '<span class="yellow-text">' + chqNo + '</span>');
            Materialize.Toast.removeAll();
            Materialize.toast($toastContent, 3000);
            return false;
        } else {
            return true;

        }
    }

    //set req option to save manual cheque entry and hit frontend api
    function SaveManualChequeEntry() {

        //$('#saveChequeEntryForm').attr('disabled', true);

        var chqNumber = $("#chequeNo").val().trim();
        var payeeName = $('#payeeName').val();
        var amount = $('#amountId').val();
        var chqDate = $('#chequeDate').val();
        var remark = $('#remark').val();

        var chqType = "";
        //  $("#acPayeePreViewText").val().trim();
        if ($("#acPayee").is(':checked')) {
            chqType = "A/c Payee";
        } else {

            chqType = "";
        }
        var data = {
            chqNumber: chqNumber,
            payeeName: payeeName,
            amount: amount,
            chqDate: chqDate,
            remark: remark,
            chqType: chqType
        }
        // links in app.js in app.locals
        var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.SAVE_MANUAL_CHEQUE_PRINT_ENTRY%>";


        $.ajax({
            url: url,
            type: "POST",
            data: data,
            dataType: 'json',
            success: function (data) {
                // if (data != null) {
                //     window.location.href = "/admin"
                // }
                if (data.success == true) {
                    ////Materialize.Toast.removeAll();
                    Materialize.toast(data.msg, 3000, 'toastMg');
                    window.location.href = "/index";
                } else if (data.success == false) {
                    //$('#saveChequeEntryForm').attr('disabled', false);
                    ////Materialize.Toast.removeAll();
                    Materialize.toast(data.msg, 3000, 'toastError');
                    console.log(data);
                }
            },
            error: function (xhr) {
                //$('#saveChequeEntryForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Something went wrong. Please retry', 3000, 'toastError');
                $(".hiddenAjaxLoader").hide();
                $("body").css({
                    "overflow": "show"
                });
            }
        });


    }

</script>
<style>
    .textPosition {
        margin: 0 !important;
    }

    .dateBox {
        width: 18px;
        height: 23px;


    }

    .dateDimension {
        display: table-cell;
        vertical-align: middle;
    }

    .dateDimension p {
        margin: 0 !important;
    }


    @media print {
        body * {
            visibility: hidden;
        }

        #chequePreview,
        #chequePreview * {
            visibility: visible;
        }

        #addImage {
            visibility: hidden;
        }

        #chequePreview {
            width: 100% !important;
            position: absolute;
            left: 0 !important;
            top: 0 !important;
        }
    }
</style>
<% include ../commonComponents/footer.ejs %>

</html>