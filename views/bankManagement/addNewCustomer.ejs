<!DOCTYPE html>
<html>

<head>
    <% include bankCommanComp/header.ejs %>

    <style>

        .planDropDown{
            padding: 10px;
            margin-bottom: 30px; 
        }

        .planDetailsId{
            padding: 10px;
            margin-bottom: 30px;  
        }

        .paymentDetails{
            margin-top: 230px
        }
            
           
           .container .row {
               margin-left: auto;
               margin-right: auto;
               border-radius: 5px;
           }
           
            ::-webkit-input-placeholder {
               /* WebKit browsers */
               color: #bdbdbd;
               opacity: 1 !important;
           }
           
           button.btn-floating {
               border: 1px #bdbdbd solid;
           }
           
           .footer {
               position: relative;
               /*   float:center !important; */
               /* bottom:10%; */
               top: 20%;
               text-align: center;
               /* left:30vw;  */
               margin-left: 3%;
           }
           .container{
               transform: translate(20px, 50px);
           }
           @media only screen and (max-width: 600px) {
               .container{
               transform: translate(0, 0);
           }
           .footer {
               top: 7%;
           }
           }
           @media only screen and (min-width: 601px) and (max-width: 992px) {
                 .container{
                transform: translate(0px, 120px); 
           }
           }
       </style>


</head>

<body>

    <div class="background">
        <div class="img"></div>
        <div class="overlay"></div>
        <div class="container">
            <!-- <form id="saveUserDetailsForm"> -->
                <div class="row  z-depth-3">
                    <div class="col l12 m12 s12">
                        <h4 class="center">Personal Details</h4>
                    </div>
                    <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                        <i class="material-icons prefix">person</i>
                        <input id="name" type="text" class="validate" name="name" required>
                        <label for="name" class="active">Name</label>

                    </div>


                    <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                        <i class="material-icons prefix">stay_current_portrait</i>
                        <input id="mobileNo" type="tel" id="mobileNo" class="validate" name="mobileNumber" required
                            minlength="10" maxlength="10">
                        <label for="mobileNo" class="active">Mobile No.</label>

                    </div>

                    <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                        <i class="material-icons prefix">mail</i>
                        <input id="emailId" type="email" class="validate" name="emailId">
                        <label for="emailId" data-error="wrong" data-success="right" class="active">Email Id</label>
                    </div>

                    <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                        <i class="material-icons prefix">person</i>
                        <input id="address" type="text" class="validate" name="address" required>
                        <label for="address" class="active">Address</label>
                    </div>

                    <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                        <i class="material-icons prefix">person</i>
                        <input id="password" type="password" class="validate" name="password" required>
                        <label for="password" class="active">Create password</label>

                    </div>


                    <div class="input-field col s12 m5 l5 push-l1 push-m1 ">
                        <i class="material-icons prefix">stay_current_portrait</i>
                        <input id="confirmPassword" type="password" id="confirmPassword" class="validate" name="mobileNumber" onblur="confirmPasswordBlur();"  required>
                        <label for="confirmPassword" class="active">Confirm Password</label>

                    </div>

                    <div class="col l12 m12 s12">
                            <h4 class="center"> Plan & Payment </h4>
                        </div>
                        <div class="input-field  col s12 m6 l6 push-l2 push-m2 offset-m1 offset-l1 planDropDown ">
                            <i class="material-icons prefix">business_center </i>
                            <span class="selectLabel"><span class="red-text">*&nbsp;
                                    <select id="planId" name="planId" required="" aria-required="true">
                                        <option value="0" selected>Choose a Plan</option>
                                    </select>
                        </div>
                        <br>
                        <br>
                        <div class="row col s6 m16 l6 z-depth-5 push-l3 push-m3 planDetailsId" id="planDetailsId">
                            <h5 class="center">Plan Details:</h5>
    
    
    
    
                            <h6>Name: <span id="planName"></span></h6>
                            <h6>No Of Print: <span id="noOfPrint"></span></h6>
                            <h6>No of Accounts: <span id="noOfAccount"></span></h6>
                            <h6>Duration: <span id="duration"></span></h6>
                            <h6>Cost: <span id="cost"></span></h6>
                            <h6>Total Amount: <span id="totalAmount"></span></h6>
                            <button class="btn waves-effect waves-light blue darken-8" id="pay" onclick="saveUserAndPayment()">
                                Pay<i class="material-icons right">send</i> </button>
                        </div>
                </div>



                <!-- <div class="row  z-depth-3">
                    <div class="col l12 m12 s12">
                        <h4 class="center"> Login Credentials </h4>
                    </div>
                    <div class="input-field col s12 m6 l6 push-l2 push-m2 offset-m1 offset-l1 ">
                        <i class="material-icons prefix">person</i>
                        <input id="userId" class="validate" name="userId" required>
                        <label for="userId" id="useridvalid" class="active" data-success="">User Id</label>
                    </div>

                    <div class="input-field col col s12 m6 l6 push-l2 push-m2 offset-m1 offset-l1 ">

                        <i class="material-icons prefix">vpn_key</i>
                        <input id="password" name="password" required>
                        <label for="password" class="active">Create Password</label>

                    </div>


                    <div class="input-field col s12 m6 l6 push-l2 push-m2 offset-m1 offset-l1">
                        <i class="material-icons prefix">vpn_key</i>

                        <input id="confirmPassword" name="confirmPassword" onblur="confirmPasswordBlur();" required
                            style="margin-bottom:5px;">
                        <label for="confirmPassword" class="active">Confirm Password</label>
                        <span id="CnfrmpasswordLabel" class="red-text"></span>

                    </div>


                </div> -->

                <!-- <div class="row  z-depth-3">
                    <div class="col l12 m12 s12">
                        <h4 class="center"> Plan & Payment </h4>
                    </div>
                    <div class="input-field  col s12 m6 l6 push-l2 push-m2 offset-m1 offset-l1 planDropDown ">
                        <i class="material-icons prefix">business_center </i>
                        <span class="selectLabel"><span class="red-text">*&nbsp;
                                <select id="planId" name="planId" required="" aria-required="true">
                                    <option value="0" selected>Choose a Plan</option>
                                </select>
                    </div>
                    <br>
                    <br>
                    <div class="row col s6 m16 l6 z-depth-5 push-l3 push-m3 planDetailsId" id="planDetailsId">
                        <h5 class="center">Plan Details:</h5>




                        <h6>Name: <span id="planName"></span></h6>
                        <h6>No Of Print: <span id="noOfPrint"></span></h6>
                        <h6>No of Accounts: <span id="noOfAccount"></span></h6>
                        <h6>Duration: <span id="duration"></span></h6>
                        <h6>Cost: <span id="cost"></span></h6>
                        <h6>Total Amount: <span id="totalAmount"></span></h6>
                        <button class="btn waves-effect waves-light blue darken-8" type="submit" id="pay" onclick="saveUserAndPayment()">
                            Pay<i class="material-icons right">send</i> </button>
                    </div>
                </div> -->
                <div class="col s12 m6 l4 offset-l5 center-align">
                    <button class="btn waves-effect waves-light blue darken-8" id="saveUserDetailsachin"
                        onclick="saveUserWithoutPayment()">
                        Submit<i class="material-icons right">send</i> </button>
                </div>
                <br>
            <!-- </form> -->
        </div>
    </div>


    <script>

        //check password and confirm password are same or not
        function confirmPasswordBlur() {
            var password = $('#password').val().trim();
            var confirmPassword = $('#confirmPassword').val().trim();
            if (password != confirmPassword) {
                Materialize.Toast.removeAll();
                Materialize.toast('password are not match.', 3000, 'toastError');
                $('#confirmPassword').val("");
                return false;
            }

        }
        $(document).ready(function () {
            $("#planDetailsId").hide();
            fetchPlanDataForDropDown();

            // $('#confirmPassword').onblur(function () {
            //     var password = $('#password').val().trim();
            //     var confirmPassword = $('#confirmPassword').val().trim();
            //     if (password != confirmPassword) {
            //         Materialize.Toast.removeAll();
            //         Materialize.toast('password are not match.', 3000, 'toastError');
            //         return false;
            //     }

            // });

            $('#planId').change(function () {

                var planId = $('#planId').val();
                if (planId != 0) {
                    $("#planDetailsId").show();
                    fetchPlanByID(planId);
                } else {
                    $("#planDetailsId").hide();
                }

            })

        });

        // fetch Bank List for Dropdown
        function fetchPlanDataForDropDown() {
            var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.FETCH_PLAN_LIST%>";
            $.ajax({
                url: url,
                type: "GET",
                // data: data,
                // contentType: 'application/json,charset=utf-8',
                beforeSend: function () {
                    $(".hiddenAjaxLoader").show();
                },
                complete: function () {
                    $(".hiddenAjaxLoader").hide();
                },
                dataType: 'json',
                success: function (data) {
                    if (data.success == true) {
                        Materialize.Toast.removeAll();
                        setPlanDataForDropDown(data);

                    } else if (data.success == false) {
                        Materialize.Toast.removeAll();
                        Materialize.toast(data.msg, 3000, 'toastError');
                    }

                    // w.postMessage({
                    //     cmd: TaskListMessage.LOAD_BRAND,
                    //     data: data
                    // });
                },
                error: function (xhr) {
                    Materialize.Toast.removeAll();
                    Materialize.toast('Something went wrong. Please retry', 3000, 'toastError');
                    $(".hiddenAjaxLoader").hide();
                    $("body").css({
                        "overflow": "show"
                    });
                }
            });
        }


        // sets Bank data in drop down
        function setPlanDataForDropDown(planData) {
            var data = planData.planList;
            $("select#planId").empty();

            $('<option>', {
                value: 0,
                text: "Choose Plan"
            }).appendTo("select#planId");

            for (i = 0; i < data.length; i++) {
                // for (i = data.length - 1; i >= 0; i--) {

                $('<option>', {
                    value: data[i].id,
                    text: data[i].planName
                }).appendTo("select#planId");
            }
            $("select#planId").trigger("change");
        }


        function fetchPlanByID(id) {
            var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.FETCH_PLAN_BY_ID%>/" + id;
            $.ajax({
                url: url,
                type: "GET",
                beforeSend: function () {
                    $(".hiddenAjaxLoader").show();
                },
                complete: function () {
                    $(".hiddenAjaxLoader").hide();
                },
                dataType: 'json',
                success: function (data) {
                    if (data.success == true) {
                        Materialize.Toast.removeAll();
                        //setPlanDataForDropDown(data);
                        var plan = data.plan;
                        $("#planName").text(plan.planName);
                        $("#noOfPrint").text(plan.noOfPrint);
                        $("#noOfAccount").text(plan.noOfAccount);
                        $("#duration").text(plan.duration + " Days only");
                        $("#cost").text(plan.planCost + "+ 18% GST charge");
                        var totalAmt = parseFloat(plan.planCost) + parseFloat((plan.planCost * 18) / 100);
                        $("#totalAmount").text(totalAmt)

                    } else if (data.success == false) {
                        Materialize.Toast.removeAll();
                        Materialize.toast(data.msg, 3000, 'toastError');
                    }

                },
                error: function (xhr) {
                    Materialize.Toast.removeAll();
                    Materialize.toast('Something went wrong. Please retry', 3000, 'toastError');
                    $(".hiddenAjaxLoader").hide();
                    $("body").css({
                        "overflow": "show"
                    });
                }
            });
        }


        // function to save user with paystatus false if payment not done
        function saveUserWithoutPayment() {
            $('#saveUserDetailsForm').attr('disabled', true);

            var name = $("#name").val().trim();
            var mobileNo = $("#mobileNo").val().trim();
            var emailId = $("#emailId").val().trim();
            var confirmPassword = $("#confirmPassword").val().trim();
            var planId = $("#planId").val();
            var address = $('#address').val();
            var payStatus = false;

            if (planId == 0) {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Choose a plan.', 3000, 'toastError');
                return false;
            } else if (name == "") {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Enter Name.', 3000, 'toastError');
            } else if (mobileNo == "") {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Enter mobile number.', 3000, 'toastError');
            } else if (confirmPassword == "") {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Enter Password.', 3000, 'toastError');
            }
            var data = {
                name: name,
                mobileNo: mobileNo,
                emailId: emailId,
                password: confirmPassword,
                address: address,
                planId: planId,
                payStatus: payStatus
            }
            var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.SAVE_USER_DETAILS%>";

            $.ajax({
                url: url,
                type: 'POST',
                data: data,
                dataType: 'json',
                success: function (data) {

                    // if (data != null) {
                    //     window.location.href = "/admin"
                    // }
                    if (data.success == true) {
                        ////Materialize.Toast.removeAll();
                        Materialize.toast(data.msg, 3000, 'toastMg');
                        // $('#saveAccountForm').attr('disabled', false);
                        // $("#bankname").val("");
                        // $("#bankshortname").val("");

                        window.location.href = "/";
                        // hitForTableData();
                    } else if (data.success == false) {
                        $('#saveBankSubmit').attr('disabled', false);
                        ////Materialize.Toast.removeAll();
                        Materialize.toast(data.msg, 3000, 'toastError');
                        console.log(data);
                    }
                },
                error: function (xhr) {
                    $('#saveAccountForm').attr('disabled', false);
                    Materialize.Toast.removeAll();
                    Materialize.toast('Something went wrong. Please retry', 3000, 'toastError');
                    $(".hiddenAjaxLoader").hide();
                    $("body").css({
                        "overflow": "show"
                    });
                }
            });

        }


        // function to save user with payment done
        function saveUserAndPayment() {
            $('#saveUserDetailsForm').attr('disabled', true);

            var name = $("#name").val().trim();
            var mobileNo = $("#mobileNo").val().trim();
            var emailId = $("#emailId").val().trim();
            var confirmPassword = $("#confirmPassword").val().trim();
            var planId = $("#planId").val();
            var payStatus = true;

            if (planId == 0) {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Choose a plan.', 3000, 'toastError');
                return false;
            } else if (name == "") {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Enter Name.', 3000, 'toastError');
            } else if (mobileNo == "") {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Enter mobile number.', 3000, 'toastError');
            } else if (confirmPassword == "") {
                $('#saveUserDetailsForm').attr('disabled', false);
                Materialize.Toast.removeAll();
                Materialize.toast('Please Enter Password.', 3000, 'toastError');
            }
            var data = {
                name: name,
                mobileNo: mobileNo,
                emailId: emailId,
                password: confirmPassword,
                address: address,
                planId: planId,
                payStatus: payStatus
            }
            var url = "<%= FRONTEND.BASE_URL+BANK_FRONTEND.SAVE_USER_DETAILS%>";

            $.ajax({
                url: url,
                type: 'POST',
                data: data,
                contentType: 'application/json,charset=utf-8',
                // contentType: 'application/json,charset=utf-8',
                // beforeSend: function () {
                //     $(".hiddenAjaxLoader").show();
                // },
                // complete: function () {
                //     $(".hiddenAjaxLoader").hide();
                // },
                // dataType: 'json',
                success: function (data) {

                    // if (data != null) {
                    //     window.location.href = "/admin"
                    // }
                    if (data.success == true) {
                        ////Materialize.Toast.removeAll();
                        Materialize.toast(data.msg, 3000, 'toastMg');
                        // $('#saveAccountForm').attr('disabled', false);
                        // $("#bankname").val("");
                        // $("#bankshortname").val("");

                        window.location.href = "/login";
                        // hitForTableData();
                    } else if (data.success == false) {
                        $('#saveBankSubmit').attr('disabled', false);
                        ////Materialize.Toast.removeAll();
                        Materialize.toast(data.msg, 3000, 'toastError');
                        console.log(data);
                    }
                },
                error: function (xhr) {
                    $('#saveAccountForm').attr('disabled', false);
                    Materialize.Toast.removeAll();
                    Materialize.toast('Something went wrong. Please retry', 3000, 'toastError');
                    $(".hiddenAjaxLoader").hide();
                    $("body").css({
                        "overflow": "show"
                    });
                }
            });

        }
    </script>
</body>


</html>